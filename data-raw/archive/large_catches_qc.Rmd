---
title: "QA / QC Josh Questions Exploration"
author: "Erin Cain"
date: '2022-05-23'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Days with Large Catches 

The following markdown reviews large catches on RST monitoring programs. 

```{r}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, fig.width=15, fig.height=10)
library(tidyverse)
library(googleCloudStorageR)

# Sys.setenv("GCS_AUTH_FILE" = "config.json")
# Sys.setenv("GCS_DEFAULT_BUCKET" = "jpe-dev-bucket")
# 
# gcs_get_object(object_name = "jpe-model-data/",
#                 bucket = gcs_get_global_bucket(),
#                 saveToDisk = "../../data/jpe-model-data/battle_rst_environmental.csv",
#                 overwrite = TRUE)



```

```{r}
RST_catch <- read_csv("../../data/jpe-model-data/jpe_weekly_unmarked_catch.csv") %>% 
  rename(jwk = Jwk, yr = Yr, stream = tributary, 
         catch = u1, fork_length = u1_sz, weekly_hours_fished = Eff) %>%
  mutate(stream = tolower(stream), 
         site = tolower(site)) %>%
  glimpse()

```

## Plots {.tabset}

### Battle Creek

```{r}
RST_catch %>% 
  filter(stream == "battle creek", run == "spring") %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Battle Creek Count Distribution Each Year")+ 
  theme(legend.position = "none") 
```

### Butte Creek 

```{r}
RST_catch %>% 
  filter(stream == "butte creek", run == "spring") %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Butte Creek Count Distribution Each Year")+ 
  theme(legend.position = "none") 



RST_catch %>% 
  filter(stream == "butte creek", run == "spring", catch < 1000) %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Filtered Butte Creek Count Distribution Each Year")+ 
  theme(legend.position = "none") 
```

### Clear Creek

```{r}
RST_catch %>% 
  filter(stream == "clear creek", run == "spring") %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Clear Creek Count Distribution Each Year")+ 
  theme(legend.position = "none") 
```

### Deer Creek

```{r}
RST_catch %>% 
  filter(stream == "deer creek") %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Deer Creek Count Distribution Each Year")+ 
  theme(legend.position = "none") 
```

### Feather River

Feather River values are typically below 100 each week. No plus count? 
#TODO 
```{r}
RST_catch %>% 
  filter(stream == "feather river", run == "spring") %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Feather River Count Distribution Each Year")+ 
  theme(legend.position = "none") 


RST_catch %>% 
  filter(stream == "feather river", run == "spring", catch < 750) %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Filtered feather River Count Distribution Each Year")+ 
  theme(legend.position = "none") 
```

### Mill Creek

```{r}
RST_catch %>% 
  filter(stream == "mill creek") %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Mill Creek Count Distribution Each Year")+ 
  theme(legend.position = "none") 
```

### Sacramento River 

```{r}
RST_catch %>% 
  filter(stream == "lower sacramento - knights landing", run == "spring") %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Lower Sac Knights Landing Count Distribution Each Year") + 
  theme(legend.position = "none") 
```

```{r}
RST_catch %>% 
  filter(stream == "lower sacramento - tisdale", run == "spring") %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Lower Sac Tisdale Count Distribution Each Year") + 
  theme(legend.position = "none") 
```


```{r}
RST_catch %>% 
  filter(stream == "yuba river", run == "spring") %>% 
  ggplot() + 
  geom_boxplot(aes(x = catch, y = as.character(yr), fill = stream)) + 
  theme_minimal() + 
  labs(title = "Yuba River Count Distribution Each Year")
```

## Exceeding Weekly Catch Thresholds

The following tables look at how often monitoring programs exceed 500 and 1000 catch per week. 

```{r}
count_exceeds_threshold <- RST_catch %>% 
  filter(run %in% c("not recorded", "spring")) %>%
  group_by(stream) %>%
  summarize(counts_above_500 = sum(catch > 500),
            counts_above_1000 = sum(catch > 1000))
count_exceeds_threshold
```

```{r}
yearly_count_exceeds_threshold <- RST_catch %>% 
   filter(run %in% c("not recorded", "spring")) %>%
  group_by(stream, yr) %>%
  summarize(counts_above_500 = sum(catch > 500),
            counts_above_1000 = sum(catch > 1000))

yearly_count_exceeds_threshold

View(yearly_count_exceeds_threshold)
```