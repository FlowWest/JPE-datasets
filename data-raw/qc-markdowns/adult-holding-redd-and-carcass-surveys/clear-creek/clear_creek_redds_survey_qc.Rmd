---
title: "Clear Redds Survey QC"
author: "Inigo Peng"
date: "11/4/2021"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(googleCloudStorageR)
library(ggplot2)
library(scales)
library (RColorBrewer)
```


# Clear Creek Adult Redds Survey 

## Description of Monitoring Data

These Redd data were collected by the U.S. Fish and Wildlife Service's, Red Bluff Fish and Wildlife Office's, Clear Creek Monitoring Program.These data encompass spring-run Chinook Salmon escapent index surveys from 2008 to 2019. Data were collected on Lower Clear Creek from Whiskeytown Dam located at river mile 18.1, (40.597786N latitude, -122.538791W longitude) to the Clear Creek Video Station located at river mile 0.0 (40.504836N latitude, -122.369693W longitude ) near the confluence with the Sacramento River.						

The Redds worksheet contains all redd data collected, including geospatial coordinates, substrate information, and redd measurements from 2000-2020 surveys.									

**Timeframe:** 2000 - 2019

**Completeness of Record throughout timeframe:** Sampled each year

**Sampling Location:** Clear Creek 

**Data Contact:** [Ryan Schaefer](mailto:ryan_a_schaefer@fws.gov)

This [report](https://www.fws.gov/redbluff/CC%20BC/Clear%20Creek%20Monitoring%20Final%20Reports/2013-2018%20Clear%20Creek%20Adult%20Spring-run%20Chinook%20Salmon%20Monitoring.pdf) gives additional information on Adult Chinook monitoring and redd surveys. 

## Access Cloud Data

```{r, eval=FALSE}
# Run Sys.setenv() to specify GCS_AUTH_FILE and GCS_DEFAULT_BUCKET before running 
# getwd() to see how to specify paths 
# Open object from google cloud storage
# Set your authentication using gcs_auth
gcs_auth(json_file = Sys.getenv("GCS_AUTH_FILE"))
# Set global bucket 
gcs_global_bucket(bucket = Sys.getenv("GCS_DEFAULT_BUCKET"))
# git data and save as xlsx
gcs_get_object(object_name = "adult-holding-redd-and-carcass-surveys/clear-creek/data-raw/FlowWest SCS JPE Data Request_Clear Creek.xlsx",
               bucket = gcs_get_global_bucket(),
               saveToDisk = "raw_redd_holding_carcass_data.xlsx")
               # Overwrite = TRUE)
```

Read in data from google cloud, glimpse raw data sheet: 

```{r include=FALSE}
 
raw_redds_data <-readxl::read_excel("raw_redd_holding_carcass_data.xlsx", 
                                    sheet = "Redds", 
                                    col_types = c("date", "text", "text", "numeric","text","numeric", "numeric", "numeric","numeric", "numeric", "numeric", "numeric", "text","numeric", "text", "date","text","text","text","numeric","text","text","text","text","text","text","text","text","text","date","numeric","numeric","numeric","numeric","numeric","numeric","numeric","text","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","text","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric", "date","numeric","date","numeric","date","numeric","date","numeric","date","numeric","date","numeric","date","numeric","date","numeric","date","numeric", "text","text","date","numeric","numeric")) %>% glimpse()
```

## Data Transformation

Note:

survey_[2-9]_age is described as "Age of redd based on age classification during survey (2-9)". Age[1-9] is also described as "age of redd based on age classification during survey (1-9)", Dropping survey_[2-9]_age and age[1-9] for now until further review. Will likely want to pick one age to keep. 

TODO: The last 4 variables observation_reach, observation_date, observation_age, and survey_observed need further description.

```{r}
cleaner_data <- raw_redds_data %>% 
  janitor::clean_names() %>%
  rename('longitude' = 'point_x',
         'latitude' = 'point_y',
         'survey' = 'survey_8',
         'picket_weir_location' = 'pw_location',
         'picket_weir_relation' = 'pw_relate',
         'pre_redd_substrate_size' = 'pre_sub',
         'redd_substrate_size' = 'side_sub',
         'tail_substrate_size' = 'tail_sub',
         'fish_on_redd' = 'fish_on_re',
         'pre_redd_depth' = 'pre_in',
         'redd_pit_depth' = 'pit_in',
         'redd_tail_depth' = 'tail_in',
         'redd_length_in' = 'length_in',
         'redd_width_in' = 'width_in',
         'surveyed_reach' = 'reach',
         'observation_reach'= 'reach_2',
         'observation_date' = 'date_2_2',
         'observation_age'= 'age_2_2',
         'survey_observed'= 'survey_78',
         'why_not_measured' = 'why_not_me',
         'date_measured' = 'date_mea',
         'measured' = 'measure'
         ) %>% 
  mutate(date = as.Date(date),
         observation_date = as.Date(observation_date),
         date_measured = as.Date(date_measured),
         survey = as.character(survey),
         survey_observed = as.character(survey_observed)) %>% 
  filter(species %in% c('CHINOOK', 'Chinook')) %>%
  select(-c('qc_type','qc_date','inspector','year', 'rm_latlong', 'rm_diff','flow_devic','bomb_id', 'species')) %>% #all method is snorkel, year could be extracted from date, river_latlong same as rivermile
  select(-(survey_2_age:age_9)) %>% 
  glimpse()
```
 
## Data Dictionary

The following table describes the variables included in this dataset and the percent that do not include data. 

```{r data_dictionary}
percent_na <- cleaner_data %>%
  summarise_all(list(name = ~sum(is.na(.))/length(.))) %>%
  pivot_longer(cols = everything())
  
data_dictionary <- tibble(variables = colnames(cleaner_data),
                          description = c("Survey method", 
                                          "GPS X point",
                                          "GPS Y point",
                                          "Survey Number, TODO figure out what this number means", 
                                          "River mile Number",  
                                          "?TODO", 
                                          "Above or below Upper Clear Creek Rotary Screw Trap", 
                                          "Picket weir location", 
                                          "Above or below picket weir", 
                                          "Date survey occured", 
                                          "Reach number", 
                                          "Unique ID number for a Redd", 
                                          "Age of Redd", 
                                          "Latitudinal location of the redd in the creek (RL: river left, RR: river right, RC: river center)", 
                                          "predominant type of gravel used in redd construction: injection, native, or combo (native and injection)", 
                                          "source of the injection gravel (site on Clear Creek)", 
                                          "Dominant substrate size in the pre-redd (area just of stream of the disturbance)", 
                                          "Dominant substrate size on the sides of the redd", 
                                          "Dominant substrate size in the tailspill (excavated material behind the pit)", 
                                          "TRUE if fish is seen on Redd (TRUE/FALSE)", 
                                          "TRUE if redd is measured (TRUE/FALSE)", 
                                          "Description of why the reddd was not measured if applicable", 
                                          "Date the redd was measured", 
                                          "Depth in the pre-redd (area just of stream of the disturbance)", 
                                          "Depth at the deepest part of the pit", 
                                          "Depth at the shallowest part of the tailspill", 
                                          "Length of the longest part of the disturbed area, measured parallel to streamflow (in inches)", 
                                          "Width of the widest part of the disturbed area, perpendicular to streamflow.", 
                                          "Mean water column velocity measured at 60 percent depth from the water surface or the average of the 60% depth and 80/20% depth, if the redd depth is ≥ 30 inches (Allan and Castillo 2007).", 
                                          "starting values on the mechanical flow meter at 60% depth", 
                                          "ending values on the mechanical flow meter at 60% depth", 
                                          "time the meter was in the water", 
                                          "Starting values on the mechanical flow meter at 80/20% depth", 
                                          "End values on the mechanical flow meter at 80/20% depth", 
                                          "time the meter was in the water", 
                                          "Mean water column velocity measured at 60 percent depth from the water surface if the redd depth is ≤ 30 inches from the water surface (Allan and Castillo 2007). ", 
                                          "Mean water column velocity measured at 80 percent depth from the water surface if the redd depth is ≤ 30 inches from the water surface (Allan and Castillo 2007). ", 
                                          "Comments from survey crew", 
                                          "Run call based on field data", 
                                          "Reach of observation", 
                                          "Date of observation", 
                                          "Age at observation", 
                                          "?TODO"),
                          data_type = c("factor", 
                                          "numeric",
                                          "numeric",
                                          "numeric", 
                                          "numeric",  
                                          "numeric", 
                                          "factor", 
                                          "numeric", 
                                          "factor",
                                          "date", 
                                          "ordered factor", 
                                          "integer", 
                                          "integer", 
                                          "factor", 
                                          "factor", 
                                          "factor", 
                                          "ordered factor",
                                          "ordered factor", 
                                          "ordered factor",
                                          "boolean", 
                                          "boolean", 
                                          "factor", 
                                          "date", 
                                          "numeric", 
                                          "numeric", 
                                          "numeric", 
                                          "numeric", 
                                          "numeric", 
                                          "numeric", 
                                          "integer", 
                                          "integer", 
                                          "integer", 
                                          "integer", 
                                          "integer", 
                                          "interger", 
                                          "numeric", 
                                          "numeric ", 
                                          "character", 
                                          "factor", 
                                          "ordered factor", 
                                          "date", 
                                          "integer", 
                                          "numeric"),
                          encoding = c("pw, rstr, snorkel", 
                                          NA,
                                          NA,
                                          NA, 
                                          NA,  
                                          NA, 
                                          "above, below", 
                                          NA, 
                                          "above, below",
                                          NA, 
                                          "R1, R2, R3, R4, R5, R5A, R5B, R5C, R6, R6A, R7", 
                                          NA, 
                                          NA, 
                                          "river left, river right, river center, river center to river right", 
                                          "injection, native, or combination", 
                                          "above need camp, above peltier, below dog gulch, clear creek road bridge, guardian rock, paige bar, placer, r6, r7, reading bar, whiskeytown", 
                                          "0.1-1, 1-2, 1-3, 2-3, 2-4, 3-4, 3-5, 4-5, 4-6, 6-8, >12", 
                                          "0.1-1, 1-2, 1-3, 2-3, 2-4, 3-4, 3-5, 4-5, 4-6, 6-8, 8-10, >12", 
                                          "0.1-1, 1-2, 1-3, 2-3, 2-4, 3-4, 3-5, 4-5", 
                                          "boolean", 
                                          "boolean", 
                                          "fall run, fish on redd, fish on redd when first observed measured next survey, flow too high, time constraints, too deep, too old", 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          NA, 
                                          "spring, fall, late fall", 
                                          "R1, R2, R3, R4, R5, R5A, R5B, R5C, R6, R6A, R7", 
                                          NA, 
                                          NA, 
                                          NA),
                          
                          percent_na = round(percent_na$value*100)
                          
)
knitr::kable(data_dictionary)
#saveRDS(data_dictionary, file = "data/clear_redd_data_dictionary.rds")
```


## Explore `date`

```{r}
summary(cleaner_data$date)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$date))/nrow(cleaner_data), 3) * 100` % of values in the `date` column are NA.

## Explore `observation_date`

**Description:** Date of observation

TODO: need to ask Ryan what the observation date is for 
```{r}
summary(cleaner_data$observation_date)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$observation_date))/nrow(cleaner_data), 3) * 100` % of values in the `observation_date` column are NA.

## Explore `date_measured`

```{r}
summary(cleaner_data$date_measured)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$date_measured))/nrow(cleaner_data), 3) * 100` % of values in the `date_measured` column are NA.

Note: observation date and date measured have different levels of completeness. 

## Explore Categorical Data

```{r}
cleaner_data %>% select_if(is.character) %>% colnames()
```
### Variable: `method`

TODO: what's pw? 

```{r}
cleaner_data <- cleaner_data %>% 
  mutate(method = tolower(method))
  
table(cleaner_data$method)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$method))/nrow(cleaner_data), 3) * 100` % of values in the `method` column are NA.


### Variable: `ucc_relate`

**Description:** Above or below Upper Clear Creek Rotary Screw Trap

```{r}
cleaner_data$ucc_relate <- tolower(cleaner_data$ucc_relate)
table(cleaner_data$ucc_relate)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$ucc_relate))/nrow(cleaner_data), 3) * 100` % of values in the `ucc_relate` column are NA.

### Variable: `picket_weir_relation`

**Description:** Above or below location of the Picket Weir

```{r}
cleaner_data$picket_weir_relation <- tolower(cleaner_data$picket_weir_relation)
table(cleaner_data$picket_weir_relation)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$picket_weir_relation))/nrow(cleaner_data), 3) * 100` % of values in the `picket_weir_relation` column are NA.

### Variable: `surveyed_reach`

**Description:** Reach surveyed on each survey day
```{r}
table(cleaner_data$surveyed_reach)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$survyed_reach))/nrow(cleaner_data), 3) * 100` % of values in the `surveyed_reach` column are NA.

### Variable: `redd_id`

**Description:** ID assigned to redds by data collection device for each survey day

```{r}
unique(cleaner_data$redd_id)[1:10]
```
There are `r length(unique(cleaner_data$redd_id))` unique redd ID numbers.

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$redd_id))/nrow(cleaner_data), 3) * 100` % of values in the `redd_id` column are NA.

### Variable: `redd_loc`

**Description:** Latitudinal location of the redd in the creek.

RL: river left

RR: river right

RC: river center

```{r}
cleaner_data<- cleaner_data %>% 
  mutate(redd_loc = case_when(
  redd_loc == "N/A" ~ NA_character_,
  redd_loc == "RC" ~ "river center",
  redd_loc == "RR" ~ "river right",
  redd_loc == "RL" ~ "river left",
  redd_loc == "RC to RR" ~ "river center to river right"
))
table(cleaner_data$redd_loc)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$redd_loc))/nrow(cleaner_data), 3) * 100` % of values in the `redd_loc` column are NA.

### Variable: `gravel`

**Description:** predominant type of gravel used in redd construction: injection, native, or combo (native and injection)
```{r}
cleaner_data$gravel <- tolower(cleaner_data$gravel)
table(cleaner_data$gravel)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$gravel))/nrow(cleaner_data), 3) * 100` % of values in the `gravel` column are NA.

### Variable: `inj_site`

**Description:** source of the injection gravel (site on Clear Creek)

```{r}
cleaner_data$inj_site <- tolower(cleaner_data$inj_site)
table(cleaner_data$inj_site)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$inj_site))/nrow(cleaner_data), 3) * 100` % of values in the `inj_site` column are NA.

### Variable: `pre_redd_substrate_size`

**Description:** dominant substrate size in the pre-redd (area just of stream of the disturbance) 


```{r}
table(cleaner_data$pre_redd_substrate_size)
```


**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$pre_redd_substrate_size))/nrow(cleaner_data), 3) * 100` % of values in the `pre_redd_substrate_size` column are NA.

### Variable: `redd_substrate_size`

**Description:** 

```{r}
table(cleaner_data$redd_substrate_size)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$redd_substrate_size))/nrow(cleaner_data), 3) * 100` % of values in the `redd_substrate_size` column are NA.

### Variable: `tail_redd_substrate_size`

**Description:** 

Dominant substrate size in the tailspill (excavated material behind the pit)

```{r}
table(cleaner_data$tail_substrate_size)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$tail_redd_substrate_size))/nrow(cleaner_data), 3) * 100` % of values in the `tail_redd_substrate_size` column are NA.

### Variable: `fish_on_redd`

**Description:** 

Indicates why a redd wasn't measured

```{r}
table(cleaner_data$fish_on_redd)
```

Fix inconsistencies with spelling, capitalization, and abbreviations. 

```{r}
cleaner_data$fish_on_redd <- case_when(
  cleaner_data$fish_on_redd == "No" | cleaner_data$fish_on_redd == "NO" ~FALSE, 
  cleaner_data$fish_on_redd == "Yes" | cleaner_data$fish_on_redd == "YES" ~TRUE
)
table(cleaner_data$fish_on_redd) 
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$fish_on_redd))/nrow(cleaner_data), 3) * 100` % of values in the `fish_on_redd` column are NA.


### Variable: `measured`

**Description:** indicates if a redd was measured

```{r}
table(cleaner_data$measured)
```


```{r}
cleaner_data$measured <- case_when(
  cleaner_data$measured == "NO" ~FALSE, 
  cleaner_data$measured == "YES"~TRUE
)
table(cleaner_data$measured) 
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$measured))/nrow(cleaner_data), 3) * 100` % of values in the `measured` column are NA.

### Variable: `why_not_measured`

**Description:** Indicates why a redd wasn't measured

Fix inconsistencies with spelling, capitalization, and abbreviations.

```{r}
table(cleaner_data$why_not_measured)
```
```{r}
cleaner_data<- cleaner_data %>% 
  mutate(why_not_measured = tolower(why_not_measured),
         why_not_measured = if_else(why_not_measured == "time-constraint", "time constraints", why_not_measured))

table(cleaner_data$why_not_measured)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$why_not_measured))/nrow(cleaner_data), 3) * 100` % of values in the `why_not_measured` column are NA.

### Variable: `comments`

**Description:** 
```{r}
unique(cleaner_data$comments)[1:10]
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$comments))/nrow(cleaner_data), 3) * 100` % of values in the `comments` column are NA.

### Variable: `run`

**Description:** run call based on field data


```{r}
cleaner_data<-cleaner_data %>% 
  mutate(run = tolower(run))
table(cleaner_data$run)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$run))/nrow(cleaner_data), 3) * 100` % of values in the `run` column are NA.


### Variable: `observation_reach`

**Description:** Reach of observation

Note: is this significantly different from `reach`? 

```{r}
table(cleaner_data$observation_reach)
```

### Variable: `survey`

TODO: what does this number mean?


```{r}
cleaner_data %>% 
    filter(survey != is.na(survey)) %>% 
  ggplot(aes(x = survey))+
  geom_bar()
```


There are `r length(unique(cleaner_data$survey))` unique survey numbers. 

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$survey))/nrow(cleaner_data), 3) * 100` % of values in the `survey` column are NA.

### Variable: `survey_observed`

```{r}
cleaner_data %>% 
  filter(survey_observed != is.na(survey_observed)) %>% 
  ggplot(aes(x = survey_observed))+
  geom_bar()
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$survey_observed))/nrow(cleaner_data), 3) * 100` % of values in the `survey_observed` column are NA.

## Explore Numerical Data

```{r}
cleaner_data %>% select_if(is.numeric) %>% colnames()
```
### Variable: `longitude`, `latitude`

```{r}
summary(cleaner_data$longitude)
```

```{r}
summary(cleaner_data$latitude)
```
Note longitude has 1 decimal place - not very exact.

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$longitude))/nrow(cleaner_data), 3) * 100` % of values in the `longitude` column are NA.

* `r round(sum(is.na(cleaner_data$latitude))/nrow(cleaner_data), 3) * 100` % of values in the `latitude` column are NA.

### Variable: `river_mile`

```{r}
cleaner_data %>% 
  ggplot(aes(x = river_mile, y =as.factor(year(date)))) +
  geom_point(size = 1, alpha = .5, color = "blue") + 
  labs(x = "River Mile", 
       y = "Date") +
  theme_minimal() + 
  theme(text = element_text(size = 12)) +
  labs(title = "River Mile Over The Years")
```

Seems like more redds were observed in the first 3 miles after 2012

```{r}
cleaner_data %>% 
  ggplot(aes(x=river_mile))+
  geom_histogram()+
  theme_minimal()+
  labs(title = "River Mile Distribution")
```

**Numeric Summary of river_mile Over Period of Record**

```{r}
summary(cleaner_data$river_mile)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$river_mile))/nrow(cleaner_data), 3) * 100` % of values in the `river_mile` column are NA.

### Variable: `x1000ftbreak`

TODO: No metadata description

```{r}
cleaner_data %>% 
  ggplot(aes(x= x1000ftbreak))+
  geom_histogram()+
  theme_minimal()+
  labs(title = "Distribution of x1000ftbreak")
```

**Numeric Summary of x1000ftbreak Over Period of Time**

```{r}
summary(cleaner_data$x1000ftbreak)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$x1000ftbreak))/nrow(cleaner_data), 3) * 100` % of values in the `x1000ftbreak` column are NA.

### Variable: `picket_weir_location`

**Description:** Annual picket weir location

Need description for what locations the numbers represent

There are `r length(unique(cleaner_data$picket_weir_location))` unique picket weir locations.


**Numeric Summary of picket_weir_location Over Period of Record**

```{r}
summary(cleaner_data$picket_weir_location)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$picket_weir_location))/nrow(cleaner_data), 3) * 100` % of values in the `picket_weir_location` column are NA.

### Variable: `age`

```{r}
table(cleaner_data$age)
```

**Create lookup rda for age encoding:**
```{r}
#View description of domain for viewing condition

clear_creek_redd_age <- 1:5
names(clear_creek_redd_age) <- c(
  "",
  "Clearly visible and clean (clearly defined pit and tail-spill and no periphyton or fines)",
  "Less visible with minor tail-spill flattening (pit and tail-spill still defined, periphyton growth, invertebrate presence)",
  "Barely visible with shallow pit and flattened tail-spill (periphyton growth, invertebrates)",
  "Pit and tail-spill indistinguishable from the surrounding substrate"
)

write_rds(clear_creek_redd_age, "data/clear_creek_redd_age.rds")
tibble(age = clear_creek_redd_age,
       definitions = names(clear_creek_redd_age))
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$age))/nrow(cleaner_data), 3) * 100` % of values in the `age` column are NA.

### Variable: `redd_pit_depth`

**Description:** Depth at the deepest part of the pit

```{r}
cleaner_data %>% 
  ggplot(aes(x = redd_pit_depth))+
  geom_histogram()+
  labs(title = "Redd Pit Depth Distribution")+
  theme_minimal()
```

**Numeric Summary of redd_pit_depth**

```{r}
summary(cleaner_data$redd_pit_depth)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$redd_pit_depth))/nrow(cleaner_data), 3) * 100` % of values in the `redd_pit_depth` column are NA.

### Variable: `redd_tail_depth`

**Description:** Depth at the shallowest part of the tailspill

```{r}
cleaner_data %>% 
  ggplot(aes(x = redd_tail_depth))+
  geom_histogram()+
  labs(title = "Redd Tail Depth Distribution")+
  theme_minimal()
```
```{r}
summary(cleaner_data$redd_tail_depth)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$redd_tail_depth))/nrow(cleaner_data), 3) * 100` % of values in the `redd_tail_depth` column are NA.

### Variable: `redd_length_in`

**Description:** Length of the longest part of the disturbed area, measured parallel to streamflow (in inches)

```{r}
cleaner_data %>% 
  ggplot(aes(x = redd_length_in))+
  geom_histogram()+
  labs(title = "Redd Length Distribution")+
  theme_minimal()
```

**Numeric Summary of redd_length_in over Period of Time**

```{r}
summary(cleaner_data$redd_length_in)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$redd_length_in))/nrow(cleaner_data), 3) * 100` % of values in the `redd_length_in` column are NA.

### Variable: `redd_width_in`

**Description:** Width of the widest part of the disturbed area, perpendicular to streamflow.

```{r}
cleaner_data %>% 
  ggplot(aes(x = redd_width_in))+
  geom_histogram()+
  labs(title = "Redd width Distribution")+
  theme_minimal()
```


```{r}
cleaner_data %>% 
  ggplot(aes(x = redd_width_in, y=redd_length_in))+
  geom_point(size = 1.2,color = 'red')+
  labs(title = "Redd Width VS Redd Length")+
  theme_minimal()
```

**Numeric Summary of redd_width_in over Period of Time**

```{r}
summary(cleaner_data$redd_width_in)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$redd_width_in))/nrow(cleaner_data), 3) * 100` % of values in the `redd_width_in` column are NA.

### Variable: `velocity`

**Description:** Mean water column velocity measured at 60 percent depth from the water surface or the average of the 60% depth and 80/20% depth, if the redd depth is ≥ 30 inches (Allan and Castillo 2007). 

Note: need to check unit.
```{r}
cleaner_data %>% 
  ggplot(aes(x = velocity))+
  geom_histogram()+
  labs(title = "Velocity Distribution")+
  theme_minimal()
```

**Numeric Summary of velocity  over Period of Time**
```{r}
summary(cleaner_data$velocity)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$velocity))/nrow(cleaner_data), 3) * 100` % of values in the `velocity` column are NA.

### Variable:`start_60`,`end_60`

**Description:** starting, ending values on the mechanical flow meter at 60% depth

```{r}
cleaner_data %>% 
  ggplot()+
  geom_histogram(aes(x = start_60), fill = "red", alpha = .5)+
  geom_histogram(aes(x = end_60), fill = "blue", alpha = .5)+
  labs(title = "Start 60 and End 60 Distribution", x = "Start 60 and End 60")+
  theme_minimal()

```

**Numeric Summary of start_60 and end_60 over Period of Time**

```{r}
summary(cleaner_data$start_60)
```

```{r}
summary(cleaner_data$end_60)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$start_60))/nrow(cleaner_data), 3) * 100` % of values in the `start_60` column are NA.

* `r round(sum(is.na(cleaner_data$end_60))/nrow(cleaner_data), 3) * 100` % of values in the `end_60` column are NA.

### Variable: `sec_60`

**Description:** time the meter was in the water
```{r}
cleaner_data %>% 
  ggplot(aes(x = sec_60))+
  geom_histogram()+
  labs(title = "Sec 60 Distribution")+
  theme_minimal()
```

**Numeric Summary of sec_60 over Period of Time**
```{r}
summary(cleaner_data$sec_60)
```
  
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$sec_60))/nrow(cleaner_data), 3) * 100` % of values in the `sec_60` column are NA.

### Variable: `start_80`, `end_80`

**Description:** Starting, end values on the mechanical flow meter at 80/20% depth

```{r}
cleaner_data %>% 
  ggplot()+
  geom_histogram(aes(x = start_80), fill = "red", alpha = .5)+
  geom_histogram(aes(x = end_80), fill = "blue", alpha = .5)+
  labs(title = "Start 80 and End 80 Distribution", x = "Start 80 and End 80")+
  theme_minimal()

```

**Numeric Summary of start_80 and end_80 over Period of Time**
```{r}
summary(cleaner_data$start_80)
```

```{r}
summary(cleaner_data$end_80)
```
**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$start_80))/nrow(cleaner_data), 3) * 100` % of values in the `start_80` column are NA.

* `r round(sum(is.na(cleaner_data$end_80))/nrow(cleaner_data), 3) * 100` % of values in the `end_80` column are NA.

### Variable: `secs_80`

**Description:** Time the meter was in the water at the 80/20% depth.

```{r}
cleaner_data %>% 
  ggplot(aes(x = secs_80))+
  geom_histogram(bin =10)+
  labs(title = "Sec 80 Distribution")+
  theme_minimal()
```

**Numeric Summary of secs_80 over Period of Time**

```{r}
summary(cleaner_data$secs_80)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$secs_80))/nrow(cleaner_data), 3) * 100` % of values in the `secs_80` column are NA.

### Variable: `bomb_vel60`, `bomb_vel80`

**`bomb_vel60` Description:** Mean water column velocity measured at 60 percent depth from the water surface if the redd depth is ≤ 30 inches from the water surface (Allan and Castillo 2007). 

**`bomb_vel80` Description:** Mean water column velocity measured at 80/20% percent depth from the water surface if the redd depth is ≥ 30 inches from the water surface (Allan and Castillo 2007). 

```{r}
v60 <- cleaner_data %>% 
  ggplot(aes(x = bomb_vel60))+
  geom_histogram()+
  labs(title = "Velocity at 60 Percent Depth Distribution")+
  theme_minimal()

v80 <- cleaner_data %>% 
  ggplot(aes(x = bomb_vel80))+
  geom_histogram()+
  labs(title = "Velocity at 80/20 Percent Depth Distribution")+
  theme_minimal()


gridExtra::grid.arrange(v60, v80)
```

**Numeric Summary of bomb_vel60 and bomb_vel80 over Period of Time**

```{r}
summary(cleaner_data$bomb_vel60)
```
```{r}
summary(cleaner_data$bomb_vel80)
```

Note: 0 velocity at 60 percent depth is NA? 
There's significant more measurement of redd measurement <30 inches from water.

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$vel60))/nrow(cleaner_data), 3) * 100` % of values in the `vel60` column are NA.

* `r round(sum(is.na(cleaner_data$vel80))/nrow(cleaner_data), 3) * 100` % of values in the `vel80` column are NA.


### Variable: `observation_age`

**Description:** Age at observation

```{r}
cleaner_data %>% 
  ggplot(aes(x=observation_age))+
  geom_histogram()+
  theme_minimal()+
  labs(title = "Distribution of Age at Observation")
```

**Numeric Summary of observation_age over Period of Time**

```{r}
summary(cleaner_data$observation_age)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_data$observation_age))/nrow(cleaner_data), 3) * 100` % of values in the `observation_age` column are NA.

### Summary of Identified Issues

* There are multiple metadata that needs more descriptions (x1000ftbreak, method, survey_observed, )

* There are multiple columns that seem redundant. For example: survey vs survey observed, age vs observation age, three different date columns

* Need to email Ryan to ask what how all the age columns work. 

* Non standard units (in) change to m below 

```{r}

# Convert all measures in inches to meters and rename accordingly 
cleaner_data <- cleaner_data %>%
  mutate(pre_redd_depth = pre_redd_depth / 39.37, 
         redd_pit_depth = redd_pit_depth / 39.37, 
         redd_tail_depth = redd_tail_depth / 39.37, 
         redd_length = redd_length_in / 39.37,
         redd_width = redd_width_in / 39.37) %>% 
  select(-redd_width_in, -redd_length_in)
```


## Next steps

* Work on data modeling to identify important variables needed for redd datasets.

### Columns to remove

* Suggest removing some of the location variables we currently have: `longitude`, `latitude`, `reach`, `river_mile`, `ucc_relate`, `picket_weir_relation` `surveyed_reach`, and `observed_reach`. We can probably use a subset of these. 
* Suggest removing flow meter metadata: `start_60`, `end_60`, `sec_60`, `start_80`, `end_80`, `secs_80`. And only keeping 1 velocity measure out of the three taken: `velocity`, `bomb_vel60`, `bomb_vel80`. 
* Unless we want to do any sort of habitat suitability analysis we probably do not need the substrate, depth, and gravel columns. 



### Save Cleaned data back to google cloud
```{r}
clear_redd <- cleaner_data %>% glimpse
```

```{r, eval=FALSE}
# gcs_list_objects()

f <- function(input, output) write_csv(input, file = output)
gcs_upload(clear_redd,
           object_function = f,
           type = "csv",
           name = "adult-holding-redd-and-carcass-surveys/clear-creek/data/clear_redd.csv")
```


