---
title: "Feather Carcass QC 2017"
author: "Elizabeth Stebbins"
date: '2022-12-21'
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, fig.width=15, fig.height=10)

library(tidyverse)
library(lubridate)
library(googleCloudStorageR)
library(ggplot2)
library(scales)
library(readxl)
library(janitor)
library(hms) #?as_hms()
library(RODBC)
library(knitr)
library(wesanderson)
```

# Feather River Carcass Data

## Description of Monitoring Data

See Feather Carcass Survey QC Document

## Access Cloud Data

```{r, include=FALSE}
# Run Sys.setenv() to specify GCS_AUTH_FILE and GCS_DEFAULT_BUCKET before running 
# getwd() to see how to specify paths 
# Open object from google cloud storage
# Set your authentication using gcs_auth

gcs_auth(json_file = Sys.getenv("GCS_AUTH_FILE"))
# Set global bucket 
gcs_global_bucket(bucket = Sys.getenv("GCS_DEFAULT_BUCKET"))

# get data and save as xlsx
```

Read in data from google cloud, glimpse raw data and domain description sheet. 
```{r, include=FALSE}
gcs_get_object(object_name = "adult-holding-redd-and-carcass-surveys/feather-river/data-raw/carcass/2017_2021/CAMP_Escapement_20210412.mdb",
               bucket = gcs_get_global_bucket(),
               saveToDisk = "data-raw/qc-markdowns/adult-holding-redd-and-carcass-surveys/feather-river/feather_carcass_2017_2021.mdb",
               overwrite = TRUE)

filepath <- "data-raw/qc-markdowns/adult-holding-redd-and-carcass-surveys/feather-river/feather_carcass_2017_2021.mdb"

operating_system <- ifelse(grepl("Mac", Sys.info()['nodename']) | grepl("MBP", Sys.info()['nodename']), "mac", "pc")

# Mac and PC need to run different code to pull data from Access db
if(operating_system == "pc") {
  DRIVERINFO <- "Driver={Microsoft Access Driver (*.mdb, *.accdb)};"
  PATH <- paste0(DRIVERINFO, "DBQ=", filepath)
  con <- odbcDriverConnect(PATH)
  # sqlTables(con)$TABLE_NAME
  ChopHeader_raw <- sqlFetch(con, "CarcassSurvey")
  Chops_raw <- sqlFetch(con, "CarcassChops")
  Carcass_individual_raw <- sqlFetch(con, "CarcassIndividual")
  ChopRecov_raw <- sqlFetch(con, "CarcassRecover")
    disposition_LU = sqlFetch(con, "luDisposition")
  color_LU = sqlFetch(con, "luColor")
  condition_LU = sqlFetch(con, "luCondition")
  cwtstatus_LU = sqlFetch(con, "luCWTStatus")
  spawnstatus_LU = sqlFetch(con, "luSpawnStatus")
  marktype_LU = sqlFetch(con, "luMarkType")
  species_LU = sqlFetch(con, "luSpecies")
  adfin_LU = sqlFetch(con, "luAdFinStatus")
  choptype_LU = sqlFetch(con, "luChopType")
  sex_LU = sqlFetch(con, "luSex")
  weather_LU = sqlFetch(con, "luWeather")
  run_LU = sqlFetch(con, "luRun")
  choptype_LU = sqlFetch(con, "luChopType")
} else{
  library(Hmisc)
  mdb.get(filepath, tables = TRUE) # check for name differences
  Chops_raw <- mdb.get(filepath, "CarcassChops")
  CWT_raw <- mdb.get(filepath, "CarcassIndividual")
  ChopRecov_raw <- mdb.get(filepath, "CarcassRecover")
  ChopHeader_raw <- mdb.get(filepath, "CarcassSurvey")
  # lookup tables
  disposition_LU = mdb.get(filepath, "luDisposition")
  color_LU = mdb.get(filepath, "luColor")
  condition_LU = mdb.get(filepath, "luCondition")
  cwtstatus_LU = mdb.get(filepath, "luCWTStatus")
  spawnstatus_LU = mdb.get(filepath, "luSpawnStatus")
  marktype_LU = mdb.get(filepath, "luMarkType")
  species_LU = mdb.get(filepath, "luSpecies")
  adfin_LU = mdb.get(filepath, "luAdFinStatus")
  choptype_LU = mdb.get(filepath, "luChopType")
  sex_LU = mdb.get(filepath, "luSex")
  weather_LU = mdb.get(filepath, "luWeather")
  run_LU = mdb.get(filepath, "luRun")
  # Other tables include Location, luActive, luBoat,
  # luBodyPart, luCentralValleyStreams, 
  # luDates, luEstimator, luLocationType, luMarkType,
  # luOtherMarkDisposition, luOtherObservations, luPeople, luProject,
  # luSizeClass, luSubsample,
  # luWeather, OptionLocationSubSections, OptionSelections, CarcassOtherMarks,
  # SurveyDocuments, TrapCWTS, TrapOtherSpecies, TrapSurvey, Version, 
  # luNoYes, luTransportType, TrapSalmon, CarcassOtherObsv,
  # SurveyMetadata
  detach(package:Hmisc)
}

write_csv(Chops_raw, here::here("data-raw", "qc-markdowns", "adult-holding-redd-and-carcass-surveys", "feather-river", "Chops_2017_2021.csv"))
write_csv(ChopHeader_raw, here::here("data-raw", "qc-markdowns", "adult-holding-redd-and-carcass-surveys", "feather-river", "ChopHeader_2017_2021.csv"))
write_csv(ChopRecov_raw, here::here("data-raw", "qc-markdowns", "adult-holding-redd-and-carcass-surveys", "feather-river", "ChopRecov_2017_2021.csv"))
write_csv(CWT_raw, here::here("data-raw", "qc-markdowns", "adult-holding-redd-and-carcass-surveys", "feather-river", "CWT_2017_2021.csv"))

```

## Raw Data Glimpse: {.tabset}

### Chops_raw
```{r, message = FALSE}
# TODO follow up to understand what this table is measuring
Chop_raw <- read_csv(here::here("data-raw", "qc-markdowns", "adult-holding-redd-and-carcass-surveys", "feather-river","Chops_2017_2021.csv")) |> 
  glimpse()
```

### ChopHeader_raw

```{r, message = FALSE}
ChopHeader_raw <- read_csv(here::here("data-raw", "qc-markdowns", "adult-holding-redd-and-carcass-surveys", "feather-river","ChopHeader_2017_2021.csv")) |>
  mutate(Date = as.Date(SurveyDate)) |> 
  select(-SurveyDate) |> 
  filter(year(Date) >= 2017) |> 
  glimpse()
```

### ChopRecov_raw

```{r, message = FALSE}
ChopRecov_raw <- read_csv(here::here("data-raw", "qc-markdowns", 
                                  "adult-holding-redd-and-carcass-surveys",
                                  "feather-river", "ChopRecov_2017_2021.csv")) |> 
  mutate(count = 1) |> 
  glimpse()
# adds a count column here 
```
### chops_and_tags_raw
```{r, message = FALSE}
# note: disposition ID is how they processed the fish (not how they found it)
# adds a column here titled "count" - each row is likely an individual fish
# Table in database was called CarcassIndividual
chops_and_tags_raw <- read_csv(here::here("data-raw", "qc-markdowns", "adult-holding-redd-and-carcass-surveys", "feather-river","CWT_2017_2021.csv")) |> 
  mutate(count = 1) |> 
  glimpse()

```

## Data transformations: {.tabset}

### Counts

The `chop` table contains carcass counts ranging from 0 - 999

The `chops_and_tags` table contains individual carcasses chopped and tagged.

The `chop_recovery` table contains recovered carcass counts by color


```{r}
# Using SurveyMetaID to get Date
# join with lu tables to get values from ids

#1. chop table (with dates and tag color)
chop_join <- full_join(ChopHeader_raw |> 
                                 select(SurveyMetaID, SurveyID, Date, SectionID),
                               Chop_raw,
                       by = c("SurveyID", "SurveyMetaID")) |> 
  clean_names() |> 
  left_join(species_LU |> 
            mutate(species_id = as.numeric(TaxonID),
                   species = CommonName) |> 
            select(species_id, species), by = "species_id") |>
  left_join(run_LU |> select(runID, run), 
            by = c("run_id" = "runID")) |> 
  select(-c(species_id, way_pt, r_mile, run_id)) |>
  rename(count = chop_count) |> 
  mutate(edit_time = as.POSIXct(gsub("[()]", "", edit_time), 
                                format = "%m/%d/%y %H:%M:%S"),
         creation_time = as.POSIXct(gsub("[()]", "", creation_time), 
                                    format = "%m/%d/%y %H:%M:%S")) |> glimpse()

#2. chops and tags
chops_and_tags_join <- full_join(ChopHeader_raw |> 
                                   select(SurveyMetaID, SurveyID, Date, SectionID), 
                                 chops_and_tags_raw, by = c("SurveyMetaID", "SurveyID")) |>
  clean_names() |> 
  left_join(species_LU |> 
              mutate(species_id = as.numeric(TaxonID),
                     species = CommonName) |> 
              select(species_id, species), by = "species_id") |>
  left_join(run_LU |> select(runID, run), 
            by = c("run_id" = "runID")) |>
  left_join(color_LU |> 
              select(colorID, color), by = c("color_tag_applied_id" = "colorID")) |> 
  left_join(disposition_LU |> select(DispositionID, disposition = Disposition), 
            by = c("disposition_id" = "DispositionID")) |> 
  left_join(condition_LU |> 
              select(ConditionID, condition = Condition), 
            by = c("condition_id" = "ConditionID")) |> 
  left_join(spawnstatus_LU |> select(SpawnedID, spawned = Spawned), 
            by = c("spawned_id" = "SpawnedID")) |> 
  left_join(adfin_LU |> select(AdFinClipID, ad_fin_clip_status = AdFinClip),
            by = c("ad_fin_clip_id" = "AdFinClipID")) |> 
  left_join(cwtstatus_LU |> select(CWTStatusID, cwt_status = CWTStatus),
            by = c("cwt_status_id" = "CWTStatusID")) |> 
  left_join(sex_LU |> select(SexID, sex = Sex), 
            by = c("sex_id" = "SexID")) |> 
  rename(tag_col = color, fl_mm = f_lmm, fl_cm = f_lcm,
         cwt_cd = cw_tcd, dna_nu = dn_anu) |> 
  select(-c(sex_id, disposition_id, color_tag_applied_id, species_id,
            condition_id, run_id, spawned_id, ad_fin_clip_id, cwt_status_id, r_mile, way_pt)) |> 
  glimpse()

#3. chop recovery
chop_recovery_join <- full_join(ChopHeader_raw |> 
                                  select(SurveyMetaID, SurveyID, Date, SectionID),
                                ChopRecov_raw, by = c("SurveyMetaID", "SurveyID")) |> 
  clean_names() |> 
  left_join(disposition_LU |> select(DispositionID, disposition = Disposition), 
            by = c("disposition_id" = "DispositionID")) |>
  left_join(color_LU |> 
              select(colorID, color), by = c("color_tag_recovered_id" = "colorID")) |>  
  left_join(sex_LU |> select(SexID, sex = Sex),
            by = c("sex_id" = "SexID")) |> 
  mutate(edit_time = as.POSIXct(gsub("[()]", "", edit_time), format = "%m/%d/%y %H:%M:%S"),
         creation_time = as.POSIXct(gsub("[()]", "", creation_time), format = "%m/%d/%y %H:%M:%S"),
         fl_mm = as.numeric(f_lmm),
         fl_cm = as.numeric(f_lcm)) |> 
  select(-c(f_lmm, f_lcm, way_pt, r_mile, disposition_id,
            color_tag_recovered_id, sex_id)) |> 
  rename(tag_col = color) |> 
  glimpse()

```

### Survey

The `chop_header` table contains survey metadata and covariates

```{r}
chop_header <- ChopHeader_raw |> 
  clean_names() |> glimpse()
```



## Explore Numeric Variables: {.tabset}

```{r}
# Filter clean data to show only numeric variables 
chop_join |> 
  select_if(is.numeric) |>
  colnames()
```

### Chop Join Variables: `survey_meta_id`, `section_id`, `chops_id`, `survey_id`

```{r}
summary(chop_join$survey_meta_id)
summary(chop_join$section_id)
```
```{r}
summary(chop_join$chops_id)
```
```{r}
summary(chop_join$survey_id)
```


### Chop Join Variable: `count`

**Numeric Summary of `count` over Period of Record**


```{r}
summary(chop_join$count)
```

**NA and Unknown Values**

* `r round(sum(is.na(chop_join$count))/nrow(chop_join), 3) * 100` % of values in the `count` column are NA.

**Plotting total daily chops over Period of Record**

```{r}
# daily chop count over time
chop_join |> 
  filter(!is.na(date)) |>
  mutate(year = year(date),
         fake_date = ymd(paste0("2000-", month(date), "-", day(date)))) |>
  group_by(fake_date, year) |>
  summarize(count = sum(count, na.rm = T)) |> 
  ggplot(aes(x = fake_date, y = count)) +
  geom_col() + 
  facet_wrap(~year) +
  theme_minimal() +
  theme(text = element_text(size = 15)) +
  scale_x_date(labels = date_format("%b"), date_breaks = "1 month") +
  xlab("Date")

```

This plot shows the total daily chops collected each day from August to December from 2017-2020. Chop count from this table ranges from 0 to 999 on a given day. Each square represents a different year. 

#### Chop Recovery Variables: 

```{r}
# Filter clean data to show only numeric variables 
chop_recovery_join |> 
  select_if(is.numeric) |>
  colnames()
```

### Chop Recovery Variable: `survey_meta_id`, `section_id`, `chops_id`, `survey_id`, `r_mile`, `species_id`, `run_id`

```{r}
summary(chop_recovery_join$survey_meta_id)
summary(chop_recovery_join$section_id)
```
```{r}
summary(chop_recovery_join$recover_id)
```
```{r}
summary(chop_recovery_join$survey_id)
```
```{r}
summary(chop_recovery_join$tag_recovered)
```

```{r}
# all NAs
summary(chop_recovery_join$fl_mm)
```
```{r}
# all NAs
summary(chop_recovery_join$fl_cm)
```

### Chop Recovery Variable: `count`

**Numeric Summary of `count` over Period of Record**
This variable was added under the assumption that each individual row of the chop recovery dataset represents an individual fish being recovered (i.e. each row of ```ChopRecov_raw``` had a count of 1).


**NA and Unknown Values**

* `r round(sum(is.na(chop_recovery_join$count))/nrow(chop_join), 3) * 100` % of values in the `count` column are NA.

**Plotting total daily recovered over Period of Record**

```{r}
# daily recovered chop count over time
chop_recovery_join |> 
  filter(!is.na(date)) |> 
  mutate(year = year(date),
         fake_date = ymd(paste0("2000-", month(date), "-", day(date)))) |>
  group_by(fake_date, year, disposition) |>
  summarize(count = sum(count, na.rm = T)) |> 
  ggplot(aes(x = fake_date, y = count, fill = disposition)) +
  scale_fill_brewer(palette = "Set1") +
  geom_col() + 
  facet_wrap(~year) +
  theme_minimal() +
  theme(text = element_text(size = 15)) +
  scale_x_date(labels = date_format("%b"), date_breaks = "1 month") +
  xlab("Date")
```

This plot shows daily recovered chops by year and day. The colors represent "disposition" i.e. whether the fish was chopped, tagged, or not chopped after being counted in the data. Far more individual fish were chopped after being processed than not chopped. None were tagged. 

### Chops and Tags Variables: `survey_meta_id`, `survey_id`, `individual_id`, `disc_tag_applied`, `fl_mm`, `head_nu`, `scale_nu`, `otolith_nu`, `cwt_cd`

```{r}
chops_and_tags_join |> 
  select_if(is.numeric) |> 
  colnames()
```
```{r}
summary(chops_and_tags_join$survey_meta_id)
summary(chops_and_tags_join$section_id)
summary(chops_and_tags_join$survey_id)
summary(chops_and_tags_join$individual_id)
summary(chops_and_tags_join$disc_tag_applied)
summary(chops_and_tags_join$fl_mm)
summary(chops_and_tags_join$head_nu)
summary(chops_and_tags_join$scale_nu)
summary(chops_and_tags_join$otolith_nu)
summary(chops_and_tags_join$cwt_cd)
```
### Chops and Tags Variable: `count`

**Numeric Summary of `count` over Period of Record**
This variable was added under the assumption that each individual row of the chops and tags dataset represents an individual fish being recovered (i.e. each row of ```chops_and_tags_raw``` had a count of 1).

**NA and Unknown Values**

* `r round(sum(is.na(chops_and_tags_join$count))/nrow(chop_join), 3) * 100` % of values in the `count` column are NA.

**Plotting total daily chops and tags over Period of Record**

```{r}
# daily individual chops count over time
chops_and_tags_join |> 
  filter(!is.na(date)) |> 
  mutate(year = year(date),
         fake_date = ymd(paste0("2000-", month(date), "-", day(date)))) |>
  group_by(fake_date, year, disposition) |>
  summarize(count = sum(count, na.rm = T)) |> 
  ggplot(aes(x = fake_date, y = count, fill = disposition)) +
  scale_fill_brewer(palette = "Set1") +
  geom_col() + 
  facet_wrap(~year) +
  theme_minimal() +
  theme(text = element_text(size = 15)) +
  scale_x_date(labels = date_format("%b"), date_breaks = "1 month")
```
This plot shows daily individual carcasses by year and day. The colors represent "disposition" i.e. whether the fish was chopped, tagged, or not chopped after being counted in the data. Far more individual fish were tagged after being processed than chopped. None were not chopped.  


**Plotting fork length of each sex**

```{r}
# use sex lookup table
chops_and_tags_join |>
  filter(fl_mm < 2000) |> # outlier
  ggplot(aes(x = sex, y = fl_mm)) + 
  geom_boxplot() + 
  theme_minimal() + 
  labs(y = "FL", x = "Sex") + 
  facet_wrap(~year(date))
```
This plot shows fork length (mm) of fish plotted by year. Sex categories are male, female, not recorded, and unknown.

### Chop Header Variable: `survey_meta_id`

```{r}
chop_header |> 
  select_if(is.numeric) |> 
  colnames()
```
```{r}
summary(chop_header$survey_meta_id)
summary(chop_header$section_id)
summary(chop_header$survey_week)
```


## Explore Categorical variables: {.tabset}

### Chop Clean Data

Fix inconsistencies with spelling, capitalization, and dates

```{r}
chop_join |> 
  select_if(is.character) |>
  colnames()
```
```{r}
unique(chop_join$chop_type_cd)
unique(chop_join$species)
unique(chop_join$run)
```

```{r}
chop_cleaner <- chop_join |>
  mutate_if(is.character, str_to_lower) |> 
  glimpse()
```
### Chop Recovery Clean Data

```{r}
chop_recovery_join |> 
  select_if(is.character) |>
  colnames()
```
```{r}
unique(chop_recovery_join$disposition)
unique(chop_recovery_join$tag_col)
unique(chop_recovery_join$sex)
```

```{r}
chop_recovery_cleaner <- chop_recovery_join |> 
  mutate_if(is.character, str_to_lower) |> 
           glimpse()
```
### Chops and Tags Clean Data

```{r}
chops_and_tags_join |> 
  select_if(is.character) |>
  colnames()
```
```{r}
unique(chops_and_tags_join$species)
unique(chops_and_tags_join$run)
unique(chops_and_tags_join$tag_col)
unique(chops_and_tags_join$disposition)
unique(chops_and_tags_join$condition)
unique(chops_and_tags_join$spawned)
unique(chops_and_tags_join$ad_fin_clip_status)
unique(chops_and_tags_join$cwt_status)
unique(chops_and_tags_join$sex)
```

```{r}
chops_and_tags_cleaner <- chops_and_tags_join |> 
  mutate_if(is.character, str_to_lower) |> 
           glimpse()
```

### Chop Header Clean Data

```{r}
chop_header |> 
  select_if(is.character) |> 
  colnames()
```

```{r}
unique(chop_header$boat)
```



```{r}
chop_header_cleaner <- chop_header |> 
  left_join(weather_LU |> select(WeatherID, weather = Weather), 
            by = c("weather_id" = "WeatherID")) |> 
  mutate(time_in = strftime(as.POSIXct(time_in, format = "%m/%d/%y %H:%M:%S"), "%H:%M:%S"),
         time_out = strftime(as.POSIXct(time_out, format = "%m/%d/%y %H:%M:%S"), "%H:%M:%S"),
         edit_time = as.POSIXct(edit_time, format = "%m/%d/%y %H:%M:%S"),
         weather = tolower(weather),
         water_temp_f = as.numeric(water_temp_f),
         water_temp_c = as.numeric(water_temp_c),
         secchi_cm = as.numeric(secchi_cm),
         secchi_feet = as.numeric(secchi_feet),
         flow_cfs = as.numeric(flow_cfs),
         turbidity_ntu = as.numeric(turbidity_ntu)) |> 
  select(-weather_id) |> 
  glimpse()
```


## Data Dictionaries

### Chop Count

```{r}
percent_na <- chop_cleaner |>
  summarise_all(list(name = ~sum(is.na(.))/length(.))) |>
  pivot_longer(cols = everything())


counts_data_dictionary <- tibble(variables = colnames(chop_cleaner),
                          description = c("Survey Meta ID",
                                          "Survey ID",
                                          "Date",
                                          "Section ID",
                                          "Chops ID",
                                          "Chop Type Code", 
                                          "Count", 
                                          "Data Recorder",
                                          "Creation Time",
                                          "Editor",
                                          "Edit Time",
                                          "Species",
                                          "Run Type"),
                          percent_na = round(percent_na$value*100,
                                             digits = 1))

kable(counts_data_dictionary)
```

### Chop Recovery
```{r}
percent_na <- chop_recovery_cleaner |>
  summarise_all(list(name = ~sum(is.na(.))/length(.))) |>
  pivot_longer(cols = everything())


recovery_data_dictionary <- tibble(variables = colnames(chop_recovery_cleaner),
                          description = c("Survey Meta ID",
                                          "Survey ID",
                                          "Date",
                                          "Section ID",
                                          "Recover ID",
                                          "Tag ID Recovered",
                                          "Comments",
                                          "Data Recorder",
                                          "Creation Time",
                                          "Editor",
                                          "Edit Time",
                                          "Count",
                                          "Disposition",
                                          "Tag Color",
                                          "Sex",
                                          "Fork Length (mm)",
                                          "Fork Length (cm)"),
                          percent_na = round(percent_na$value*100,
                                             digits = 1))

kable(recovery_data_dictionary)
```
### Survey

```{r}
percent_na <- chop_header_cleaner |>
  summarise_all(list(name = ~sum(is.na(.))/length(.))) |>
  pivot_longer(cols = everything())

chop_header_data_dictionary <- tibble(variables = colnames(chop_header_cleaner),
                          description = c("Survey Meta ID",
                                          "Survey ID",
                                          "Location ID",
                                          "Section ID",
                                          "Boat",
                                          "Survey Week",
                                          "Transport Type ID",
                                          "Subsample ID",
                                          "Time In",
                                          "Time Out",
                                          "Water Temp (F)",
                                          "Water Temp (C)",
                                          "Secchi (cm)",
                                          "Secchi (ft)",
                                          "Flow (cfs)",
                                          "Turbidity (NTU)",
                                          "Field Recorder",
                                          "Crew",
                                          "GPS Unit",
                                          "Comments",
                                          "Data Recorder",
                                          "Creation Time",
                                          "Editor",
                                          "Edit Time",
                                          "Date",
                                          "Weather"),
                          percent_na = round(percent_na$value*100,
                                             digits = 1))

kable(chop_header_data_dictionary)
```
### Chops and Tags Join
```{r}
percent_na <- chops_and_tags_cleaner |>
  summarise_all(list(name = ~sum(is.na(.))/length(.))) |>
  pivot_longer(cols = everything())

chops_and_tags_data_dictionary <- tibble(variables = colnames(chops_and_tags_cleaner),
                          description = c("Survey Meta ID",
                                          "Survey ID",
                                          "Date",
                                          "Section ID",
                                          "Individual ID",
                                          "Disc Tag Applied",
                                          "Fork Length (mm)",
                                          "Fork Length (cm)",
                                          "Head Number",
                                          "Scale Number",
                                          "Tissue Number",
                                          "Otolith Number",
                                          "DNA Number",
                                          "Comments",
                                          "Data Recorder",
                                          "Creation Time",
                                          "Editor",
                                          "Edit Time",
                                          "CWT Code",
                                          "Count",
                                          "Species",
                                          "Run",
                                          "Tag Color",
                                          "Disposition",
                                          "Condition",
                                          "Spawn Status",
                                          "Adipose fin clip",
                                          "CWT Status",
                                          "Sex"),
                          percent_na = round(percent_na$value*100))

kable(chops_and_tags_data_dictionary)
```
## Saved cleaned data back to google cloud
```{r}
feather_carcass_chops_2017_2021 <- chop_cleaner |> 
  glimpse()
feather_carcass_chops_and_tags_2017_2021 <- chops_and_tags_cleaner |>
  glimpse()
feather_carcass_chop_header_2017_2021 <- chop_header_cleaner |> 
  glimpse()
feather_carcass_chop_recovery_2017_2021 <- chop_recovery_cleaner |>
  glimpse()
```
```{r, include=FALSE}
f <- function(input, output) write_csv(input, file = output)

# 2017
gcs_upload(feather_carcass_chops_2017_2021,
           object_function = f,
           type = "csv",
           name = "adult-holding-redd-and-carcass-surveys/feather-river/data/feather_carcass_chops_2017_2021.csv")
gcs_upload(feather_carcass_chops_and_tags_2017_2021,
           object_function = f,
           type = "csv",
           name = "adult-holding-redd-and-carcass-surveys/feather-river/data/feather_carcass_chops_and_tags_2017_2021.csv")
gcs_upload(feather_carcass_chop_header_2017_2021,
           object_function = f,
           type = "csv",
           name = "adult-holding-redd-and-carcass-surveys/feather-river/data/feather_carcass_chop_header_2017_2021.csv")
gcs_upload(feather_carcass_chop_recovery_2017_2021,
           object_function = f,
           type = "csv",
           name = "adult-holding-redd-and-carcass-surveys/feather-river/data/feather_carcass_chop_recovery_2017_2021.csv")

```




