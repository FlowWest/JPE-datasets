---
title: "Yuba River Carcass QC"
author: "Maddee Rubenson (FlowWest)"
date: "`r Sys.Date()`"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, fig.width=15, fig.height=10)
library(tidyverse)
library(lubridate)
library(googleCloudStorageR)
library(ggplot2)
library(scales)
library(readxl)

google_cloud_access <- FALSE

```

# Yuba River Carcass Data

## Description of Monitoring Data

**Timeframe:**

Min date: `2009-09-08` Max date: `2022-01-26`

**Video Season:**

**Completeness of Record throughout timeframe:**

**Sampling Location:**

Sampling location is based on river mile.

**Data Contact:**

Jessica Nichols [Escapement Protocols](/data-raw/qc-markdowns/adult-holding-redd-and-carcass-surveys/yuba-river/Escapement%20Protocol%202011%20-%20internal%20review%20draft_09-16-2011.docx)

## Access Cloud Data

```{r, eval=FALSE}
# Run Sys.setenv() to specify GCS_AUTH_FILE and GCS_DEFAULT_BUCKET before running 
# Open object from google cloud storage

if(google_cloud_access = TRUE) {
  gcs_auth(json_file = Sys.getenv('GCS_AUTH_FILE'))
  gcs_global_bucket(bucket = Sys.getenv('GCS_DEFAULT_BUCKET'))
  
  gcs_list_objects()
  # git data and save as xlsx
  gcs_get_object(object_name = "adult-holding-redd-and-carcass-surveys/yuba-river/data-raw/Carcass_datarequest07122022.xlsx",
                 bucket = gcs_get_global_bucket(),
                 saveToDisk = "raw_carcass_yuba_river.xlsx",
                 overwrite = TRUE)
}
```

Read in data from google cloud, glimpse raw data and domain description sheet:

```{r}
# read in data to clean 

sheets <- excel_sheets("raw_carcass_yuba_river.xlsx")
sheets 
raw_carcass_data <- read_excel("raw_carcass_yuba_river.xlsx", 
                               sheet = "Carcass") %>% glimpse()

```

## Data transformations

-   modified `survey_id` to `date` and converted to date format

```{r}
# Snake case, 
# Columns are appropriate types
# Remove redundant columns

clean_yuba_carcass <- raw_carcass_data %>% janitor::clean_names() %>% 
  rename(river_mile = rm) %>%
  mutate(date = as_date(survey_id)) %>%
  select(-survey_id) %>%
  glimpse

summary(clean_yuba_carcass)
```

## Explore Numeric Variables: {.tabset}

```{r}
# Filter clean data to show only numeric variables 
```

### `river_mile`

**Plotting river_mile over Period of Record**

```{r}
summary(clean_yuba_carcass$river_mile)

ggplot() + 
  geom_histogram(data = clean_yuba_carcass, aes(river_mile))

```

### `fork_lengh`

```{r}

summary(clean_yuba_carcass$fork_length)

# histogram
ggplot() + 
  geom_histogram(data = clean_yuba_carcass, aes(fork_length))

# boxplot
ggplot() + 
  geom_boxplot(data = clean_yuba_carcass, aes(y = fork_length, x = spawned)) +
  geom_jitter(data = clean_yuba_carcass, aes(y = fork_length, x = spawned), alpha = 0.5)
```

## Explore Categorical variables: {.tabset}

### `date`

```{r}
summary(clean_yuba_carcass$date)
```

### `fresh`

```{r}
table(clean_yuba_carcass$fresh, useNA = "ifany")
```

### `adipose_clip`

```{r}
table(clean_yuba_carcass$adipose_clip, useNA = "ifany")

```

### `sex`

```{r}
table(clean_yuba_carcass$sex, useNA = "ifany")

```

### `spawned`

```{r}
table(clean_yuba_carcass$spawned, useNA = "ifany")

```

## Summary of identified issues

-   

## Save cleaned data back to google cloud

```{r}
yuba_carcass <- clean_yuba_carcass

# gcs_list_objects()
f <- function(input, output) write_csv(input, file = output)

# gcs_upload(yuba_carcass,
#            object_function = f,
#            type = "csv",
#            name = "adult-holding-redd-and-carcass-surveys/yuba-river/data/yuba_carcass.csv")
```
