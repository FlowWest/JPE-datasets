---
title: "[Watershed] [Data type] [QC]"
author: "Badhia Yunes Katz"
date: "01/25/2024"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, fig.width=15, fig.height=10)
library(tidyverse)
library(lubridate)
library(googleCloudStorageR)
library(ggplot2)
library(scales)
library(RODBC)
library(chron)
library(weathermetrics)
library(CDECRetrieve)
library(hms)
library(dplyr)
```

# Mill Creek [Data type long version]

## Description of Monitoring Data

**Timeframe:** 

**Video Season:** 

**Completeness of Record throughout timeframe:** no data gaps

**Sampling Location:** Mill Creek

**Data Contact:** 

Any additional info?

## Access Cloud Data

```{r, eval=FALSE}
# Run Sys.setenv() to specify GCS_AUTH_FILE and GCS_DEFAULT_BUCKET before running 
# getwd() to see how to specify paths 
# Open object from google cloud storage
# Set your authentication using gcs_auth
gcs_auth(json_file = Sys.getenv("GCS_AUTH_FILE"))
# Set global bucket 
gcs_global_bucket(bucket = Sys.getenv("GCS_DEFAULT_BUCKET"))

# git data and save as xlsx

```

Read in data from google cloud, glimpse raw data and domain description sheet: 
```{r}
# read in data to clean 
deer_mill <- odbcConnectAccess2007(here::here("data-raw", "standard-format-data-prep", "MASTER_TEMPERATURE.mdb"))


```

## Data transformations

```{r}
# For different excel sheets for each year read in and combine years here

tables <- sqlTables(deer_mill)


mill_1 <- sqlFetch(deer_mill,"Mill 8-0 Mouth") |> 
  mutate(date = as_date(Date)) 
mill_2 <- sqlFetch(deer_mill, "Mill 8-1 VIDEO Station")|> 
  mutate(date = as_date(Date)) 
mill_3 <- sqlFetch(deer_mill, "Mill 8-2 Little Mill Confluence")|> 
  mutate(date = as_date(Date)) 
mill_4 <- sqlFetch(deer_mill, "Mill 8-3 Rancheria")|> 
  mutate(date = as_date(Date)) 
mill_5 <- sqlFetch(deer_mill, "Mill 8-4 Black Rock")|> 
  mutate(date = as_date(Date)) 
mill_6 <- sqlFetch(deer_mill, "Mill 8-5 Sooner")|> 
  mutate(date = as_date(Date)) 
mill_7 <- sqlFetch(deer_mill, "Mill 8-6 Canyon Camp")|> 
  mutate(date = as_date(Date)) 
mill_8 <- sqlFetch(deer_mill, "Mill 8-7 Hole in Ground")|> 
  mutate(date = as_date(Date)) 
mill_9 <- sqlFetch(deer_mill, "Mill 8-8 Little Hole in Ground")|> 
  mutate(date = as_date(Date)) 
mill_10 <- sqlFetch(deer_mill, "Mill 8-9 Brokenshire")|> 
  mutate(date = as_date(Date)) 


combined_table <- bind_rows(mill_1, mill_2, mill_3 ,mill_4, mill_5, mill_6, mill_7, mill_8, mill_9, mill_10, .id = "mill_site")



```

```{r}
# Snake case, 
# Columns are appropriate types
combined_table <- combined_table |> 
   mutate(temperature = fahrenheit.to.celsius(Temperature, round = 1)) |> 
   mutate(year = lubridate::year(Date))


# Remove redundant columns

```

## Explore Numeric Variables: {.tabset}

```{r}
# Filter clean data to show only numeric variables 

mill_temp <- combined_table |> 
  select(-Date, -Time, -"Primary ID", -"Sort ID", -"Logger ID", -"Place ID")
```

### Variable: `Temperature`

**Plotting [Variable] over Period of Record**

```{r}

mill_plot <- ggplot(mill_temp, aes(x = date, y = temperature)) +
  geom_line(color = "darkred") +
  labs(y = "Temperature (deg C)")

print(mill_plot)

#adding CDEC data to plot with it and compare (with removed outliers from CDEC using 0-40C range)
MLM_CDEC <- cdec_query(station = "MLM", dur_code = "H", sensor_num = "25", start_date = "1996-01-01")


MLM_hourly_temps <- MLM_CDEC %>%
  mutate(date = as_date(datetime),
         time = as_hms(datetime),
         temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) %>%
  select(date,time,temp_degC) |> 
  filter(temp_degC < 40, temp_degC > 0) |> 
    rename(temperature = temp_degC)


# Create the combined plot
combined_plot <- mill_plot +
  geom_line(data = MLM_hourly_temps, aes(x = date, y = temperature, color = ""))
  
  

print(combined_plot)

# maybe 2+ plots are appropriate
```

**Numeric Summary of [Variable] over Period of Record**

```{r}
# Table with summary statistics
```

**NA and Unknown Values**

Provide a stat on NA or unknown values

## Explore Categorical variables: {.tabset}

General notes: If there is an opportunity to turn yes no into boolean do so, but not if you loose value 

```{r}
# Filter clean data to show only categorical variables
```


### Variable: `Temperature`
```{r}
#table() 
```

Fix inconsistencies with spelling, capitalization, and abbreviations. 

```{r}
# Fix any inconsistencies with categorical variables
```

**Create lookup rda for [variable] encoding:** 
```{r}
# Create named lookup vector
# Name rda [watershed]_[data type]_[variable_name].rda
# save rda to data/ 
```

**NA and Unknown Values**

Provide a stat on NA or unknown values

## Summary of identified issues

* List things that are funcky/bothering us but that we don't feel like should be changed without more investigation

## Save cleaned data back to google cloud 

```{r}
# Write to google cloud 
# Name file [watershed]_[data type].csv
```