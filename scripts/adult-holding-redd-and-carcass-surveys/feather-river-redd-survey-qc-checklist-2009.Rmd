---
title: "feather-river-adult-holding-redd-survey-qc-checklist-2009"
author: "Inigo Peng"
date: "10/6/2021"
output: rmarkdown::github_document
---
```{r setup, include=FALSE, fig.width=15, fig.height=10}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(tidyverse)
library(lubridate)
library(googleCloudStorageR)
library(ggplot2)
library(scales)
library(leaflet)
```
# Feather River Redd Survey Data  

## Description of Monitoring Data

**Timeframe:** 2009


**Completeness of Record throughout timeframe:2009-2020** 

**Sampling Location:** Feather River


**Data Contact:** Chris Cook 

Any additional info?
1. Latitude and longitude are in NAD 1983 UTM Zone 10N
The substrate is observed visually and an estimate of the percentage of 5 size classes. Fines <1cm, small 1-5cm, medium 6-15cm, large 16-30cm, boulder >30cm
Type refers to whether a polygon (A for Area) or point (P) was mapped with the Trimble GPS unit
A different substrate classification system was used in 2008. Each of the 5 size classes were given a number: 1=fines, 2=small, 3=medium, 4=large, 5=boulder. The dominant class was recorded as a number.
D stands for Digging. We used to record digging areas as redds that looked to be unfinished. We record only finished redds now.
Q refers to Questionable redds. Areas where the substrate was disturbed but did not have the proper characteristics to be called a redd. We no longer record questionable redds.

## Access Cloud Data

```{r, eval=FALSE}
# Run Sys.setenv() to specify GCS_AUTH_FILE and GCS_DEFAULT_BUCKET before running
# Open object from google cloud storage
# Set your authentication using gcs_auth
gcs_auth(json_file = Sys.getenv("GCS_AUTH_FILE"))
# Set global bucket 
gcs_global_bucket(bucket = Sys.getenv("GCS_DEFAULT_BUCKET"))
gcs_list_objects()
# git data and save as xlsx
gcs_get_object(object_name = "adult-holding-redd-and-carcass-surveys/feather-river/data-raw/redd_survey/2009_Chinook_Redd_Survey_Data_raw.xlsx",
               bucket = gcs_get_global_bucket(),
               saveToDisk = "2009_Chinook_Redd_Survey_Data_raw.xlsx",
               overwrite = TRUE)
```
```{r}
raw_data_2009 = readxl::read_excel("2009_Chinook_Redd_Survey_Data_raw.xlsx",
                                   sheet="2009 All Data")
```
```{r}
glimpse(raw_data_2009)

raw_data_2009$'Redd Width (ft)' = raw_data_2009$'Redd Width (ft)'/3.281
raw_data_2009$'Redd Lenght (ft)' = raw_data_2009$'Redd Lenght (ft)'/3.281
cleaner_data_2009 <- raw_data_2009 %>%
  select(-c(Remeasured, File, '#  Redds')) %>%
  add_column(longitude = NA) %>% 
  add_column(latitude = NA) %>% 
  relocate('Survey Date', .before = 'Location') %>% 
  relocate('latitude', .after = '# Salmon') %>%
  relocate('longitude', .before = 'Depth (m)') %>%  
  rename('Date' = 'Survey Date',
         'type' = 'Type (D, A, P)', 
         'salmon_counted' = '# Salmon', 
         'depth_m' = 'Depth (m)',
         'pot_depth_m' = 'Pot depth (m)',
         'velocity_m/s' = 'Velocity (m/s)',
         'percent_fine_substrate' = '% Fines (<1 cm)',
         'percent_small_substrate' = '% Small (1-5 cm)',
         'percent_medium_substrate'= '% Medium (5-15 cm)',
         'percent_large_substrate' =  '% Large (15-30 cm)',
         'percent_boulder' = '% Boulder (>30 cm)',
         'redd_width_m' = 'Redd Width (ft)',
         'redd_length_m' = 'Redd Lenght (ft)') %>%
  mutate('depth_m' = as.numeric('depth_m'),
         'pot_depth_m' = as.numeric('pot_depth_m'),
         'velocity_m/s'= as.numeric('velocity_m/s'),
         'latitude' = as.numeric(latitude),
         'longitude' = as.numeric(longitude)) %>% 
glimpse()
```
```{r}

cleaner_data_2009 <- cleaner_data_2009 %>% 
  set_names(tolower(colnames(cleaner_data_2009))) %>% 
  mutate(date = as.Date(date)) %>% 
  glimpse()
```
```{r}
cleaner_data_2009 %>% 
  select_if(is.character) %>% colnames()
```
### Variable: `location`
```{r}
table(cleaner_data_2009$location)
```
```{r}
cleaner_data_2009 <- cleaner_data_2009 %>% 
  mutate(location = tolower(location), 
         location = if_else(location == "alec", "aleck", location),
         location = if_else(location == "matthews", "mathews", location),
         location = if_else(location == "middle auditorium", "mid auditorium", location),
         )
table(cleaner_data_2009$location)
```

* `r round(sum(is.na(cleaner_data_2009$location))/nrow(cleaner_data_2009), 3)` % of values in the `location` column are NA.

```{r}
table(cleaner_data_2009$type)
```
```{r}
cleaner_data_2009 <- cleaner_data_2009 %>% 
  mutate(type = tolower(type),
         type = if_else(type == "area", "a", type),
         type = if_else(type == "point", "p", type))
table(cleaner_data_2009$type)
```


**Create lookup rda for type encoding:**
```{r}
types <- distinct(cleaner_data_2009, type) %>% 
  drop_na() %>% 
  unlist()

types_description <- c(
  "area - polygon mapped with Trimble GPS unit",
  "point - points mapped with Trimble GPS unit"
  # "questionable redds - polygon mapped with Trimble GPS unitwhere the substrate was disturbed but did not have the proper characteristics to be called a redd - it was no longer recrded after 2011"
)

write_rds(types_description, paste0(getwd(),"/adult-holding-redd-and-carcass-surveys/feather-river/data/types_description.rds"))

tibble(code = types,
       definitions = types_description)
```

```{r}
cleaner_data_2009 %>% 
  select_if(is.numeric) %>% colnames()
```

### Variable: salmon_counted
```{r}
cleaner_data_2009 %>% 
  ggplot(aes(x = date, y = salmon_counted)) + 
  geom_col() +
  facet_wrap(~year(date), scales = "free") +
  scale_x_date(labels = date_format("%b"), date_breaks = "1 month")+
  theme_minimal() +
  theme(axis.text.x = element_text(size = 10,angle = 90, vjust = 0.5, hjust=0.1)) +
  theme(axis.text.y = element_text(size = 8))
```
```{r}
# Boxplots of daily counts by year
# cleaner_data_2009  %>%
#   group_by(date) %>%
#   summarise(daily_salmon_count = sum(salmon_counted)) %>%
#   mutate(year = as.factor(year(date))) %>%
#   ggplot(aes(x = date, y = (daily_salmon_count)))+ 
#   geom_boxplot() + 
#   theme_minimal() +
#   theme(text = element_text(size = 12)) 

```
**Numeric Summary of Salmon Counted over 2009**
```{r}
cleaner_data_2009 %>%
  group_by(date) %>%
  summarise(count = sum(salmon_counted, na.rm = T)) %>%
  pull(count) %>%
  summary()
```

**NA and Unknown Values**
* `r round(sum(is.na(cleaner_data_2009$salmon_counted))/nrow(cleaner_data_2009), 5)*100` % of values in the `salmon_counted` column are NA. 

### Variable: latitude and longitude
```{r}
summary(cleaner_data_2009$latitude)
```

**NA and Unknown Values**
* `r round(sum(is.na(cleaner_data_2009$latitude))/nrow(cleaner_data_2009), 3)*100` % of values in the `latitude` column are NA.

### Variable: longitude
```{r}
summary(cleaner_data_2009$longitude)
```
**NA and Unknown Values**
* `r round(sum(is.na(cleaner_data_2009$longitude))/nrow(cleaner_data_2009), 3)*100` % of values in the `longitude` column are NA

### Variable: depth_m
**Numeric Summary of "depth_m"over 2009**
```{r}
summary(cleaner_data_2009$depth_m)
```

**NA and Unknown Values**
* `r round(sum(is.na(cleaner_data_2009$depth_m))/nrow(cleaner_data_2009), 3)*100` % of values in the `depth_m` column are NA

### Variable: pot_depth_m
**Numeric Summary of "pot_depth_m"over 2009**
```{r}
summary(cleaner_data_2009$pot_depth_m)
```

**NA and Unknown Values**
* `r round(sum(is.na(cleaner_data_2009$pot_depth_m))/nrow(cleaner_data_2009), 3)*100` % of values in the `pot_depth_m` column are NA. 

### Variable: velocity_m/s
**Numeric Summary of velocity_m/s over 2009**
```{r}
summary(cleaner_data_2009$`velocity_m/s`)
```
=
**NA and Unknown Values**
* `r round(sum(is.na(cleaner_data_2009$'velocity_m/s'))/nrow(cleaner_data_2009), 3)*100` % of values in the `velocity_m/s` column are NA.

### Variable: percent_fine_substrate
```{r}
cleaner_data_2009 %>%
  ggplot(aes(x = location, y = percent_fine_substrate)) +
  geom_col() +
  theme_minimal() +
  theme(text = element_text(size = 8)) +
  theme(axis.text.x = element_text(angle = 90))
```
```{r}
# # Boxplots of mean depth by location
cleaner_data_2009  %>%
  ggplot(aes(x = location, y = percent_fine_substrate))+
  geom_boxplot() +
  theme_minimal() +
  theme(text = element_text(size = 8)) +
  theme(axis.text.x = element_text(angle = 90))
```

```{r}
summary(cleaner_data_2009$percent_fine_substrate)
```
NA and Unknown Values**
* `r round(sum(is.na(cleaner_data_2009$'percent_fine_substrate'))/nrow(cleaner_data_2009), 3)*100` % of values in the `percent_fine_substrate` column are NA.

### Variable: percent_medium_substrate
```{r}

```
```{r}

```
**Numeric Summary of percent_medium_substrate over 2009**
```{r}

```

**NA and Unknown Values**

### Variable: percent_large_substrate
```{r}

```
**NA and Unknown Values**

### Variable: percent_boulder
```{r}

```
**Numeric Summary of percent_boulder over 2009**
```{r}

```

**NA and Unknown Values**

### Variable: redd_width_m
```{r}
cleaner_data_2009 %>%
  ggplot(aes(x = date, y = redd_width_m)) +
  geom_col() +
  theme_minimal() +
  theme(text = element_text(size = 8)) +
  theme(axis.text.x = element_text(angle = 90))
```

```{r}
cleaner_data_2009  %>%
  ggplot(aes(x = date, y = redd_width_m))+
  geom_boxplot() +
  theme_minimal() +
  theme(text = element_text(size = 12))
```
```{r}
summary(cleaner_data_2009$redd_width_m)
```
NA and Unknown Values**
* `r round(sum(is.na(cleaner_data_2009$'redd_width_m'))/nrow(cleaner_data_2009), 3)*100` % of values in the `redd_width_m` column are NA.


### Variable: redd_length_m

