---
title: "Battle Creek Adult Upstream Passage Estimates QC"
author: "Erin Cain"
date: "9/29/2021"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, fig.width=15, fig.height=10)
library(tidyverse)
library(lubridate)
library(googleCloudStorageR)
library(ggplot2)
library(scales)
library(readxl)
```

# Battle Creek Adult Upstream Passage Estimates

## Description of Monitoring Data

This dataset contains video outage information and extrapolated passage estimates for Chinook Salmon using count data from the Video and Trap and Spawning Building worksheets from 2001 to 2019. Estimates include all runs of Chinook Salmon.						

**Timeframe:** 2001 - 2019 

**Completeness of Record throughout timeframe:** Passage estimates calculated for every year in timeframe. 

**Sampling Location:** Battle Creek 

**Data Contact:** [Natasha Wingerter](mailto:natasha_wingerter@fws.gov)

Any additional info?

## Access Cloud Data

```{r, eval=FALSE}
# Run Sys.setenv() to specify GCS_AUTH_FILE and GCS_DEFAULT_BUCKET before running 
# getwd() to see how to specify paths 
# Open object from google cloud storage
# Set your authentication using gcs_auth
gcs_auth(json_file = Sys.getenv("GCS_AUTH_FILE"))
# Set global bucket 
gcs_global_bucket(bucket = Sys.getenv("GCS_DEFAULT_BUCKET"))

# git data and save as xlsx
gcs_get_object(object_name = 
                 "adult-upstream-passage-monitoring/battle-creek/data-raw/battle_creek_upstream_passage_datas.xlsx",
               bucket = gcs_get_global_bucket(),
               saveToDisk = "raw_battle_creek_passage_data.xlsx",
               overwrite = TRUE)
```

Read in data from google cloud, glimpse raw data and domain description sheet: 
```{r}

# read in data to clean 
sheets <- readxl::excel_sheets("raw_battle_creek_passage_data.xlsx")
sheets
raw_passage_estimates <- read_excel("raw_battle_creek_passage_data.xlsx", 
                                    sheet = "Upstream Passage Estimates") %>% glimpse()
```

## Data transformations

```{r}
cleaner_passage_estimates <- raw_passage_estimates %>% 
  janitor::clean_names() %>% 
  mutate(actual_number_clipped = as.numeric(actual_number_clipped),
         actual_number_unclipped = as.numeric(actual_number_unclipped),
         actual_number_unknown = as.numeric(actual_number_unknown),
         passage_estimate_clipped = as.numeric(passage_estimate_clipped),
         passage_estimate_unclipped = as.numeric(passage_estimate_unclipped)) %>%
  glimpse()

# want count, count_type = passage_estimate, actual number, adipose = cliped, unclipped, unknown

cleaner_passage_long <- cleaner_passage_estimates %>% 
  pivot_longer(!year:hours_of_taped_passage, 
               names_to = c("type", "type2", "adipose"), 
               names_sep = "_",
               values_to = "count") %>%
  mutate(count_type = paste(type, type2, sep = "_")) %>%
  select(-type, -type2) %>% glimpse()
```

## Explore Numeric Variables: {.tabset}

```{r}
cleaner_passage_long %>% select_if(is.numeric) %>% colnames()
```

### Variable: `year`, `week`

**Plotting weeks per year over Period of Record**

```{r}
cleaner_passage_long %>% 
  group_by(year) %>% 
  summarise(num_weeks_sampled = max(week)) %>% 
  ggplot() + 
  geom_col(aes(x = year, y = num_weeks_sampled))
```

Every year there were between 22 and 28 weeks sampled. 

**Numeric Summary of [Variable] over Period of Record**

```{r}
summary(cleaner_passage_long$week)
summary(cleaner_passage_long$year)
```

**NA and Unknown Values**

* `r round(sum(is.na(cleaner_passage_long$week))/nrow(cleaner_passage_long), 3) * 100` % of values in the `week` column are NA.
* `r round(sum(is.na(cleaner_passage_long$year))/nrow(cleaner_passage_long), 3) * 100` % of values in the `year` column are NA.

### Variable: `hours_of_passage`, `hours_of_taped_passage`

**Plotting  over Period of Record**

```{r}
# Make whatever plot is appropriate 
# maybe 2+ plots are appropriate
```

**Numeric Summary of [Variable] over Period of Record**

```{r}
# Table with summary statistics
```

**NA and Unknown Values**

Provide a stat on NA or unknown values

## Explore Categorical variables: {.tabset}

General notes: If there is an opportunity to turn yes no into boolean do so, but not if you loose value 

```{r}
# Filter clean data to show only categorical variables
```


### Variable: `[name]`
```{r}
#table() 
```

Fix inconsistencies with spelling, capitalization, and abbreviations. 

```{r}
# Fix any inconsistencies with categorical variables
```

**Create lookup rda for [variable] encoding:** 
```{r}
# Create named lookup vector
# Name rda [watershed]_[data type]_[variable_name].rda
# save rda to data/ 
```

**NA and Unknown Values**

Provide a stat on NA or unknown values

## Summary of identified issues

* List things that are funcky/bothering us but that we don't feel like should be changed without more investigation

## Save cleaned data back to google cloud 

```{r}
# Write to google cloud 
# Name file [watershed]_[data type].csv
```