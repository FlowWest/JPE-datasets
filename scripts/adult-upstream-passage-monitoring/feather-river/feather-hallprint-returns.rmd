---
title: "Feather River Hallprint Data QC"
author: "Erin Cain"
date: "9/29/2021"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, fig.width=15, fig.height=10)
library(tidyverse)
library(lubridate)
library(googleCloudStorageR)
library(ggplot2)
library(scales)
library(readxl)
```

# Feather River hallprint adult broodstock selection and enumeration data

## Description of Monitoring Data

We currently only have one file describing fish returns. We can likely acquire more but the return data is currently very messy and not stored in a consistent format across years. 

The excel workbook that we have has 15 sheets. Most sheets are summaries of hallprint tagging data. This markdown is focused on the `Carcass Recoveries` tab of the workbook. 

**Timeframe:** 2018
  
**Season:** Carcass Recoveries appear to be found from September - December
  
**Completeness of Record throughout timeframe:** 
  
**Sampling Location:** 
   
**Data Contact:** [Byron Mache](mailto:Byron.Mache@water.ca.gov) 
  
  
## Access Cloud Data
  
```{r, eval=FALSE}
# Run Sys.setenv() to specify GCS_AUTH_FILE and GCS_DEFAULT_BUCKET before running 
# getwd() to see how to specify paths 
# Open object from google cloud storage
# Set your authentication using gcs_auth
gcs_auth(json_file = Sys.getenv("GCS_AUTH_FILE"))
# Set global bucket 
gcs_global_bucket(bucket = Sys.getenv("GCS_DEFAULT_BUCKET"))

gcs_list_objects()
# git data and save as xlsx
gcs_get_object(object_name = 
                 "adult-upstream-passage-monitoring/feather-river/hallprint/data-raw/returns/FRFH HP RUN DATA 2018 as of 9-10-20.xlsx",
               bucket = gcs_get_global_bucket(),
               saveToDisk = "raw_feather_hallprint_returns_data.xlsx",
               overwrite = TRUE)
```

Read in data from google cloud, glimpse raw data and domain description sheet: 
```{r}
# read in data to clean 
sheets <- excel_sheets("raw_feather_hallprint_returns_data.xlsx")
sheets # many sheets, most do not seem useful 
raw_carcass_data <- read_excel("raw_feather_hallprint_returns_data.xlsx", 
                               sheet = "Carcass Recoveries",
                               range = "A1:V209") %>% # additonal columns are summaries
  glimpse()
```

## Data transformations

```{r}
# For different excel sheets for each year read in and combine years here
cleaner_carcass_data <- raw_carcass_data %>% 
  set_names(tolower(colnames(raw_carcass_data))) %>% 
  rename("individual_id" = individualid, 
         "survey_id" = surveyid, 
         "other_marks" = othermarks,
         "distinct_tag_applied" = disctagapplied, 
         "color_tag_applied" = colortagapplied, 
         "spawn_status" = spawnstatus, 
         "fl_cm" = flcm, 
         "adipose_fin_clip" = adfinclip, 
         "head_number" = headnumber, 
         "scale_number" = scalenumber, 
         "tissue_number" = tissuenumber,
         "otolith_number" = otolithnumber) %>% 
  mutate(date = as.Date(date),
         survey_id = as.character(survey_id),
         individual_id = as.character(individual_id),
         otolith_number = as.numeric(otolith_number)) %>%
  filter(species == "CHN") %>%
  select(-flmm) %>% # we already have flcm
  glimpse()
```


## Explore Numeric Variables: {.tabset}

```{r}
# Filter clean data to show only numeric variables 
cleaner_carcass_data %>% select_if(is.numeric) %>% colnames()
```

### Variable: `week`

```{r}
hist(cleaner_carcass_data$week)
```
Numeric Summary: 

```{r}
summary(cleaner_carcass_data$week)
```

**NA and Unknown Values**
```{r}
sum(is.na(cleaner_carcass_data$week))
```

There are no NA values in `week`. 

### Variable: ``

```{r}
hist(cleaner_carcass_data$fl_cm)
```

**NA and Unknown Values**
```{r}

```
There are no NA values in ``. 

## Explore Categorical variables: {.tabset}

```{r}
# Filter clean data to show only categorical variables
cleaner_carcass_data %>% select_if(is.character) %>% colnames()
```

### Variable: ``

```{r}

```

**NA and Unknown Values**
```{r}

```
There are no NA values in ``. 
